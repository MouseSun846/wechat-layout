/*! For license information please see sidepanel.js.LICENSE.txt */
(()=>{function e(){var n,r,o="function"==typeof Symbol?Symbol:{},a=o.iterator||"@@iterator",i=o.toStringTag||"@@toStringTag";function c(e,o,a,i){var c=o&&o.prototype instanceof u?o:u,s=Object.create(c.prototype);return t(s,"_invoke",function(e,t,o){var a,i,c,u=0,s=o||[],d=!1,f={p:0,n:0,v:n,a:v,f:v.bind(n,4),d:function(e,t){return a=e,i=0,c=n,f.n=t,l}};function v(e,t){for(i=e,c=t,r=0;!d&&u&&!o&&r<s.length;r++){var o,a=s[r],v=f.p,p=a[2];e>3?(o=p===t)&&(c=a[(i=a[4])?5:(i=3,3)],a[4]=a[5]=n):a[0]<=v&&((o=e<2&&v<a[1])?(i=0,f.v=t,f.n=a[1]):v<p&&(o=e<3||a[0]>t||t>p)&&(a[4]=e,a[5]=t,f.n=p,i=0))}if(o||e>1)return l;throw d=!0,t}return function(o,s,p){if(u>1)throw TypeError("Generator is already running");for(d&&1===s&&v(s,p),i=s,c=p;(r=i<2?n:c)||!d;){a||(i?i<3?(i>1&&(f.n=-1),v(i,c)):f.n=c:f.v=c);try{if(u=2,a){if(i||(o="next"),r=a[o]){if(!(r=r.call(a,c)))throw TypeError("iterator result is not an object");if(!r.done)return r;c=r.value,i<2&&(i=0)}else 1===i&&(r=a.return)&&r.call(a),i<2&&(c=TypeError("The iterator does not provide a '"+o+"' method"),i=1);a=n}else if((r=(d=f.n<0)?c:e.call(t,f))!==l)break}catch(e){a=n,i=1,c=e}finally{u=1}}return{value:r,done:d}}}(e,a,i),!0),s}var l={};function u(){}function s(){}function d(){}r=Object.getPrototypeOf;var f=[][a]?r(r([][a]())):(t(r={},a,function(){return this}),r),v=d.prototype=u.prototype=Object.create(f);function p(e){return Object.setPrototypeOf?Object.setPrototypeOf(e,d):(e.__proto__=d,t(e,i,"GeneratorFunction")),e.prototype=Object.create(v),e}return s.prototype=d,t(v,"constructor",d),t(d,"constructor",s),s.displayName="GeneratorFunction",t(d,i,"GeneratorFunction"),t(v),t(v,i,"Generator"),t(v,a,function(){return this}),t(v,"toString",function(){return"[object Generator]"}),(e=function(){return{w:c,m:p}})()}function t(e,n,r,o){var a=Object.defineProperty;try{a({},"",{})}catch(e){a=0}t=function(e,n,r,o){function i(n,r){t(e,n,function(e){return this._invoke(n,r,e)})}n?a?a(e,n,{value:r,enumerable:!o,configurable:!o,writable:!o}):e[n]=r:(i("next",0),i("throw",1),i("return",2))},t(e,n,r,o)}function n(e,t,n,r,o,a,i){try{var c=e[a](i),l=c.value}catch(e){return void n(e)}c.done?t(l):Promise.resolve(l).then(r,o)}function r(e){return function(){var t=this,r=arguments;return new Promise(function(o,a){var i=e.apply(t,r);function c(e){n(i,o,a,c,l,"next",e)}function l(e){n(i,o,a,c,l,"throw",e)}c(void 0)})}}function o(){return"visitor-"+Math.random().toString(36).substr(2,9)}function a(){return i.apply(this,arguments)}function i(){return(i=r(e().m(function t(){var n;return e().w(function(e){for(;;)if(0===e.n)return n=localStorage.getItem("visitorId"),e.a(2,n)},t)}))).apply(this,arguments)}function c(){var e=localStorage.getItem("visitorId");return e||(e=o(),localStorage.setItem("visitorId",e)),e}function l(e){var t=JSON.parse(localStorage.getItem("verifiedUsers")||"[]");t.includes(e)||(t.push(e),localStorage.setItem("verifiedUsers",JSON.stringify(t)))}function u(){document.getElementById("subscriptionModal").style.display="block";var e=document.getElementById("passcodeInput");e&&(e.value="")}function s(){document.getElementById("subscriptionModal").style.display="none"}function d(e,t){return f.apply(this,arguments)}function f(){return(f=r(e().m(function t(n,r){var o,a,i,u,d;return e().w(function(e){for(;;)switch(e.p=e.n){case 0:return o={method:"POST",headers:{Accept:"*/*","Accept-Encoding":"gzip, deflate, br","User-Agent":"PostmanRuntime-ApipostRuntime/1.1.0",Connection:"keep-alive","Content-Type":"application/json"},body:JSON.stringify({passcode:r})},e.p=1,e.n=2,fetch("https://lgy-in-dev.cnbita.com/dxjewkl7l-d7fe-2559-ab62-c3b95a066a82/api/passcode/verify",o);case 2:return a=e.v,e.n=3,a.json();case 3:if(200!==(i=e.v).code||!i.data||!i.data.valid){e.n=4;break}return l(c()),s(),e.a(2,!0);case 4:return alert(i.message||(null===(u=i.data)||void 0===u?void 0:u.message)||"口令验证失败"),e.a(2,!1);case 5:e.n=7;break;case 6:return e.p=6,d=e.v,console.error(d),alert("验证过程中出现错误，请重试"),e.a(2,!1);case 7:return e.a(2)}},t,null,[[1,6]])}))).apply(this,arguments)}document.addEventListener("DOMContentLoaded",function(){var t=document.getElementById("markdownInput"),n=document.getElementById("convertButton"),i=document.getElementById("theme-select"),c=document.getElementById("font-select"),l=document.getElementById("subscriptionModal"),f=document.getElementById("passcodeInput"),v=document.getElementById("verifyPasscode"),p=document.getElementById("cancelVerification"),m=document.querySelector(".modal-close"),b=[{label:"默认主题",value:"default"},{label:"橙心",value:"chengxin"},{label:"墨黑",value:"mohei"},{label:"姹紫",value:"chazi"},{label:"嫩青",value:"nenqing"},{label:"绿意",value:"lvyi"},{label:"红绯",value:"hongfei"},{label:"WeChat-Format",value:"wechat-format"},{label:"蓝莹",value:"lanying"},{label:"科技蓝",value:"kejilan"},{label:"兰青",value:"lanqing"},{label:"山吹",value:"shanchui"},{label:"前端之巅同款",value:"qianduan"},{label:"极客黑",value:"jikehei"},{label:"简",value:"jian"},{label:"蔷薇紫",value:"qiangweizi"},{label:"萌绿",value:"menglv"},{label:"全栈蓝",value:"quanzhanlan"}],g=[{label:"无衬线",value:"fonts-no-cx"},{label:"衬线",value:"fonts-cx"}];setTimeout(function(){console.log("Populating theme options"),b.forEach(function(e){var t=document.createElement("option");t.value=e.value,t.textContent=e.label,i.appendChild(t)}),console.log("Theme options populated")},100),setTimeout(function(){console.log("Populating font options"),g.forEach(function(e){var t=document.createElement("option");t.value=e.value,t.textContent=e.label,c.appendChild(t)}),console.log("Font options populated")},100),n.addEventListener("click",r(e().m(function r(){var o,l,s,d,f;return e().w(function(e){for(;;)switch(e.p=e.n){case 0:return e.p=0,e.n=1,Promise.race([a(),new Promise(function(e,t){return setTimeout(function(){return t(new Error("获取用户ID超时"))},5e3)})]);case 1:o=e.v,e.n=3;break;case 2:return e.p=2,f=e.v,console.error("获取用户ID失败:",f),alert("获取用户身份信息失败，请检查网络连接后重试"),n.disabled=!1,n.textContent="转换并插入",e.a(2);case 3:if(o){e.n=4;break}return u(),e.a(2);case 4:if(l=t.value,s=i.value,d=c.value,""!==l.trim()){e.n=5;break}return alert("请输入 Markdown 文本"),e.a(2);case 5:n.disabled=!0,n.textContent="转换中...",chrome.tabs.query({active:!0,currentWindow:!0},function(e){if(e.length>0){var t=e[0].id;chrome.tabs.sendMessage(t,{action:"convertMarkdown",markdown:l,theme:s,font:d},function(e){n.disabled=!1,n.textContent="转换并插入",chrome.runtime.lastError?(console.error("Error sending message:",chrome.runtime.lastError),alert("无法连接到页面，请刷新页面后重试")):e&&"success"===e.status?console.log("Markdown converted and inserted successfully."):e&&"error"===e.status&&(console.error("Error converting Markdown:",e.message),alert("转换失败: ".concat(e.message)))})}else n.disabled=!1,n.textContent="转换并插入",alert("找不到活动标签页")});case 6:return e.a(2)}},r,null,[[0,2]])}))),v.addEventListener("click",r(e().m(function t(){var r,i;return e().w(function(e){for(;;)switch(e.n){case 0:if(r=f.value.trim()){e.n=1;break}return alert("请输入口令"),e.a(2);case 1:return e.n=2,a();case 2:return(i=e.v)||(i=o()),e.n=3,d(i,r);case 3:e.v&&n.click();case 4:return e.a(2)}},t)}))),p.addEventListener("click",function(){s()}),m.addEventListener("click",function(){s()}),window.addEventListener("click",function(e){e.target===l&&s()})})})();